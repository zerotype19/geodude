<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow">
  <title>Optiview Status</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }
    h1 {
      font-size: 32px;
      margin-bottom: 8px;
      color: #1a202c;
    }
    .subtitle {
      color: #718096;
      margin-bottom: 32px;
      font-size: 14px;
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 24px;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 24px;
    }
    .status-ok {
      background: #d1fae5;
      color: #065f46;
    }
    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }
    .status-loading {
      background: #fef3c7;
      color: #92400e;
    }
    .indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .indicator-ok { background: #10b981; }
    .indicator-error { background: #ef4444; }
    .indicator-loading { background: #f59e0b; }
    .metric {
      display: flex;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    .metric:last-child { border-bottom: none; }
    .metric-label {
      color: #64748b;
      font-size: 14px;
    }
    .metric-value {
      font-weight: 600;
      color: #1e293b;
    }
    .metrics-grid {
      margin-top: 24px;
      background: #f8fafc;
      border-radius: 12px;
      padding: 20px;
    }
    .budget-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }
    .budget-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #059669);
      transition: width 0.3s ease;
    }
    .footer {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e2e8f0;
      color: #94a3b8;
      font-size: 12px;
      text-align: center;
    }
    .refresh-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      margin-top: 16px;
      width: 100%;
      transition: background 0.2s;
    }
    .refresh-btn:hover {
      background: #5568d3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Optiview Status</h1>
    <p class="subtitle">Real-time system health & metrics</p>
    
    <div id="status-badge" class="status-badge status-loading">
      <div class="indicator indicator-loading"></div>
      <span>Checking status...</span>
    </div>

    <div class="metrics-grid">
      <div class="metric">
        <span class="metric-label">API Status</span>
        <span class="metric-value" id="api-status">—</span>
      </div>
      <div class="metric">
        <span class="metric-label">Latest Audit</span>
        <span class="metric-value" id="latest-audit">—</span>
      </div>
      <div class="metric">
        <span class="metric-label">Citations Budget</span>
        <span class="metric-value" id="budget-status">—</span>
      </div>
      <div id="budget-bar-container" style="display: none;">
        <div class="budget-bar">
          <div class="budget-fill" id="budget-fill"></div>
        </div>
      </div>
    </div>

    <button class="refresh-btn" onclick="loadStatus()">Refresh Status</button>

    <div class="footer">
      Last updated: <span id="timestamp">—</span><br>
      <a href="https://api.optiview.ai/status" target="_blank" style="color: #667eea;">View JSON</a>
    </div>
  </div>

  <script>
    async function loadStatus() {
      const badge = document.getElementById('status-badge');
      badge.className = 'status-badge status-loading';
      badge.innerHTML = '<div class="indicator indicator-loading"></div><span>Checking status...</span>';

      try {
        const [statusRes, budgetRes] = await Promise.all([
          fetch('https://api.optiview.ai/status'),
          fetch('https://api.optiview.ai/v1/citations/budget')
        ]);

        const status = await statusRes.json();
        const budget = await budgetRes.json();

        // Update status badge
        if (status.status === 'ok') {
          badge.className = 'status-badge status-ok';
          badge.innerHTML = '<div class="indicator indicator-ok"></div><span>All Systems Operational</span>';
        } else {
          badge.className = 'status-badge status-error';
          badge.innerHTML = '<div class="indicator indicator-error"></div><span>System Issues Detected</span>';
        }

        // Update metrics
        document.getElementById('api-status').textContent = status.status.toUpperCase();
        
        const auditTime = status.latest_audit?.completed_at;
        if (auditTime) {
          const date = new Date(auditTime + 'Z');
          const timeAgo = getTimeAgo(date);
          document.getElementById('latest-audit').textContent = timeAgo;
        } else {
          document.getElementById('latest-audit').textContent = 'No audits yet';
        }

        // Update budget
        const used = budget.used || 0;
        const max = budget.max || 200;
        const remaining = budget.remaining || max;
        const percentage = (remaining / max) * 100;

        document.getElementById('budget-status').textContent = `${remaining}/${max} remaining`;
        document.getElementById('budget-fill').style.width = `${percentage}%`;
        document.getElementById('budget-bar-container').style.display = 'block';

        // Update timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

      } catch (error) {
        badge.className = 'status-badge status-error';
        badge.innerHTML = '<div class="indicator indicator-error"></div><span>Connection Error</span>';
        document.getElementById('api-status').textContent = 'ERROR';
        console.error('Status check failed:', error);
      }
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)} min ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
      return `${Math.floor(seconds / 86400)} days ago`;
    }

    // Auto-refresh every 30 seconds
    setInterval(loadStatus, 30000);
    
    // Load on page load
    loadStatus();
  </script>
</body>
</html>

